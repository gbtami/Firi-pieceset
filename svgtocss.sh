#!/bin/sh

ODIR=./out/
OCSS=outfile.css
if ! command -v inkscape &> /dev/null; then echo "Inkscape not found" ; exit 1 ; fi

# input file , output file
base64SVG() {
  inkscape --export-type=svg --export-filename=$2 $1
  BASE64_ENCODED=$(base64 -w 0 "$2")
}

# input file name , base64 value
emitcss() {
  echo ".shogi piece.$1 {"
  echo "background-image: url(\"data:image/svg+xml;base64,$2\"); }"
}

genAll() {
  echo '/* Autogenerated by svgtocss, do not edit! */' > $OCSS
  for w in w*.svg; do
    base64SVG $w $ODIR/$w
    name=$(tr + p <<< ${w:1}) # drop first char & replace + with p
    emitcss "${name%.svg}-piece.white.ally" $BASE64_ENCODED >> $OCSS
    emitcss "${name%.svg}-piece.white.enemy" $BASE64_ENCODED >> $OCSS
  done
  for b in b*.svg; do
    base64SVG $b $ODIR/$b
    name=$(tr + p <<< ${b:1}) # drop first char & replace + with p
    emitcss "${name%.svg}-piece.black.ally" $BASE64_ENCODED >> $OCSS
    emitcss "${name%.svg}-piece.black.enemy" $BASE64_ENCODED >> $OCSS
  done
}

genAll
