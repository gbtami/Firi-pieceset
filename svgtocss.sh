#!/bin/bash
ODIR=./out/
if ! command -v inkscape &> /dev/null
then echo "Inkscape is not installed. Please install it before running this script." ; exit 1 fi

# Check if input file is provided
if [ -z "$1" ]; then echo "Usage: $0 input.svg" ; exit 1 ; fi

INPUT_FILE=$1
OUTPUT_FILE="${INPUT_FILE%.svg}-optimized.svg"

echo "Optimizing SVG..."
inkscape --export-type=svg --export-filename="$OUTPUT_FILE" "$INPUT_FILE"

if [ $? -ne 0 ]; then echo "Error optimizing the SVG file." ; exit 1 ; fi

# Encode the optimized SVG in Base64
echo "Encoding SVG to Base64..."
BASE64_ENCODED=$(base64 -w 0 "$OUTPUT_FILE")
echo 'Autogenerated by svgtocss, do not edit!' > $ODIR/out

if [ $? -ne 0 ]; then echo "Error encoding the SVG file." ; exit 1 ; fi

# Output the CSS line
echo "CSS Output:"
echo "background-image: url('data:image/svg+xml;base64,$BASE64_ENCODED');"

# Optional: Remove the optimized SVG file after encoding
# Uncomment this if you don't want to keep the optimized SVG
# rm "$OUTPUT_FILE"

echo "Done!"
